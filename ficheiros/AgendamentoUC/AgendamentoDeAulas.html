<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Horário ISCTE</title>
    <link rel="stylesheet" type="text/css" href="estilos.css">
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>
</head>

<body>
    <h1>Agendamento de Aulas:</h1>

    <!-- Formulário para solicitar 3 inputs -->
    <form id="userInputForm">

        <div class="input-container">
            <label for="UC">Nome da UC:</label>
            <input type="text" id="UC" name="UC" required><br><br>
        </div>
        
        <div class="input-container">
            <label for="Licenciatura">Nome da Licenciatura:</label>
            <input type="text" id="Licenciatura" name="Licenciatura" required><br><br>
        </div>
        
        <br>
        <div class="input-container">
        <label for="nmrAulas">Número de aulas:</label>
        <input type="number" id="nmrAulas" name="nmrAulas" max="40" min ="1" required><br><br>
        </div>

        <div class="input-container">
        <label for="nmrAlunos">Número máximo de alunos:</label>
        <input type="number" id="nmrAlunos" name="nmrAlunos"><br><br>
        </div>

        <div class="input-container">
        <label for="semanaSemestre">Semana do semestre a começar a UC:</label>
        <input type="number" id="semanaSemestre" name="semanaSemestre" max="21" min="1"><br><br>
        </div>

        <br>
        <label for="input4">Períodos em que é <strong>possível</strong> alocar as aulas:</label><br>
        <input type="checkbox" id="manha" name="periodoPossivel" value="8-12.30">
        <label for="manha">Manhã (8:00 - 12:30)</label><br>
        <input type="checkbox" id="tarde" name="periodoPossivel" value="12.30-18.30">
        <label for="tarde">Tarde (12:30 - 18:30)</label><br>
        <input type="checkbox" id="noite" name="periodoPossivel" value="18.30-23">
        <label for="noite">Noite (18:30 - 23:00)</label><br><br>


        <label for="input5">Preferência de dias da semana:</label><br>
        <input type="checkbox" value="Seg" name="diaDaSemanaPref" id="Segunda-feira">
        <label for="segunda">Segunda-feira</label><br>
        <input type="checkbox" value="Ter" name="diaDaSemanaPref" id="Terça-feira">
        <label for="terca">Terça-feira</label><br>
        <input type="checkbox" value="Qua" name="diaDaSemanaPref" id="Quarta-feira">
        <label for="quarta">Quarta-feira</label><br>
        <input type="checkbox" value="Qui" name="diaDaSemanaPref" id="Quinta-feira">
        <label for="quinta">Quinta-feira</label><br>
        <input type="checkbox" value="Sex" name="diaDaSemanaPref" id="Sexta-feira">
        <label for="sexta">Sexta-feira</label><br>
        <input type="checkbox" value="Sab" name="diaDaSemanaPref" id="Sábado">
        <label for="sabado">Sábado</label><br>


        <div class="form-group">
            <div id="preferencias-container">
                <p>Preferência de Sala:</p>
                <select class="form-select" id="preferenciaSala1" aria-label="Default select example">
                    <option selected>Escolha uma Preferência</option>
                </select>
            </div>
            <button type="button" class="btn btn-secondary" id="addPreferenceBtn">Adicionar Preferência</button>
            
        </div>
        <div class="form-group">
            <div id="salasInaceitaveis-container">
            <p>Salas Inaceitáveis:</p>
            <select class="form-select" id='salasInaceitaveis' aria-label="Default select example">
                <option selected>Indique as salas inaceitáveis</option>
            </select>
            </div>
            <button type="button" class="btn btn-secondary" id="addSalaInaceitavel">Adicionar salas inaceitáveis</button>
        </div>   
</div>
<br><br>
    
        <input type="submit" value="Submit">
    </form>

    <script type="text/javascript">
        var nomesSalas;
        var salas;
        var tiposDeSala;
        const pathJsonSalas = 'CaracterizacaoDasSalas.json';    
        fetch(pathJsonSalas)
            .then(response => {
                // Verificar se o request foi bem sucedido
                if (!response.ok) {
                    throw new Error(`Failed to fetch ${pathJsonSalas}: ${response.statusText}`);
                }

                // Parse the JSON data
                return response.json();
            })

            .then(data => {

                 salas = data;

                function initializeSelectOptionsSalas() {
            tiposDeSala = ['Anfiteatro', 'Arquitetura', 'BYOD', 'Focus Group', 'Laboratório de Arquitetura de Computadores', 'Laboratório de Bases de Engenharia', 'Laboratório de Electrónica', 'Laboratório de Informática', 'Laboratório de Jornalismo', 'Laboratório de Redes de Computadores', 'Laboratório de Telecomunicações', 'Sala Aulas Mestrado', 'Sala Aulas Mestrado Plus', 'Sala NEE', 'Sala Provas', 'Sala Reunião', 'Sala de Arquitectura', 'Sala de Aulas normal', 'videoconferência', 'Átrio'];
            nomesSalas = salas.map(room => room['Nome sala']);

            const preferenciaSala1 = document.getElementById('preferenciaSala1');
            const salasInaceitaveis = document.getElementById('salasInaceitaveis');

            // Adicionar cada tipo de sala existente aos respetivos inputs
            tiposDeSala.forEach(tipoDeSala => {
                const optionTipoSala = document.createElement('option');
                optionTipoSala.textContent = tipoDeSala;
                preferenciaSala1.appendChild(optionTipoSala);

                const OptionTipoSalaInaceitavel = document.createElement('option');
                OptionTipoSalaInaceitavel.textContent = tipoDeSala;
                salasInaceitaveis.appendChild(OptionTipoSalaInaceitavel);
            });

            
            // Adicionar cada sala existente no json com a Caracterização das Salas aos respetivos inputs
            nomesSalas.forEach(nomeSala => {
                const optionPreferencia1 = document.createElement('option');
                optionPreferencia1.textContent = nomeSala;
                preferenciaSala1.appendChild(optionPreferencia1);

                const optionSalasInaceitaveis = document.createElement('option');
                optionSalasInaceitaveis.textContent = nomeSala;
                salasInaceitaveis.appendChild(optionSalasInaceitaveis);
            });
        }

    initializeSelectOptionsSalas();


    })
    .catch(error => {
        console.error(`Error loading ${pathJsonSalas}:`, error);
    });

    

    /**
     *  Adiciona um evento de click ao botão para adicionar mais uma preferência de sala e ao botão
     *  para adicionar mais uma sala inaceitável. Este evento adiciona mais um input de prefrência ou
     *  de sala inaceitável, consoante o botão clicado. Este input irá conter os tipos de sala e as
     *  salas existentes no ficheiro json da caracterização das salas.
     *  
    */
    document.addEventListener('DOMContentLoaded', function () {
        const addButton = document.getElementById('addPreferenceBtn');
        const addButtonSalasIn =  document.getElementById('addSalaInaceitavel');;

        const preferencesContainer = document.getElementById('preferencias-container');
        const inaceitavelCointainer = document.getElementById('salasInaceitaveis-container');

        let preferenceCount = 1;
        let inaceitavelCount = 1;

        addButton.addEventListener('click', function () {
            preferenceCount++;

            // Adiciona um novo input para as salas preferidas
            const preferenceDiv = document.createElement('div');
            preferenceDiv.classList.add('form-group');
            preferenceDiv.innerHTML = `<div class="form-group">
                <p>Preferência nº${preferenceCount}:</p>
                <select class="form-select" id="preferenciaSala${preferenceCount}" aria-label="Default select example">
                    <option selected>Escolha uma Preferência</option>
                </select>
                </div>
            `;

            preferencesContainer.appendChild(preferenceDiv);

            const novaPref = document.getElementById(`preferenciaSala${preferenceCount}`);

            // Adiciona as opções de tipo de sala ao novo input criado
            tiposDeSala.forEach(tipoDeSala => {
                const optionTipoSala = document.createElement('option');
                optionTipoSala.textContent = tipoDeSala;
                novaPref.appendChild(optionTipoSala);
            })

            // Adiciona as opções com as salas existentes ao novo input criado
            nomesSalas.forEach(nomeSala => {
                const optionSalas = document.createElement('option');
                optionSalas.textContent = nomeSala;
                novaPref.appendChild(optionSalas);
            });
        });

        addButtonSalasIn.addEventListener('click', function () {
            inaceitavelCount++;

            // Adiciona um novo input para as salas inaceitáveis
            const inaceitavelDiv = document.createElement('div');
            inaceitavelDiv.classList.add('form-group');
            inaceitavelDiv.innerHTML = `<div class="form-group">
                <p>Sala inaceitável nº${inaceitavelCount}:</p>
                <select class="form-select" id="salaInaceitavel${inaceitavelCount}" aria-label="Default select example">
                    <option selected>Escolha uma sala inaceitável</option>
                </select>
                </div>
            `;

            inaceitavelCointainer.appendChild(inaceitavelDiv);

            const novaInaceitavel = document.getElementById(`salaInaceitavel${inaceitavelCount}`);

            // Adiciona as opções de tipo de sala ao novo input criado
            tiposDeSala.forEach(tipoDeSala => {
                const optionTipoSala = document.createElement('option');
                optionTipoSala.textContent = tipoDeSala;
                novaPref.appendChild(optionTipoSala);
            })

            // Adiciona as opções com as salas existentes ao novo input criado
            nomesSalas.forEach(nomeSala => {
                const optionSalas = document.createElement('option');
                optionSalas.textContent = nomeSala;
                novaInaceitavel.appendChild(optionSalas);
            });
        });
    });

    

     
    </script>
    </div>
</body>
</html>