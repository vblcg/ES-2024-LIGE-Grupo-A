<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Salas ISCTE</title>
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>
</head>

<body>

    <div id="table-horario">
        <script type="text/javascript">
    
    
    
        const pathJson = '../../../../../output.json';
    
        var minMaxFilterEditor = function(cell, onRendered, success, cancel, editorParams){
    
            var end;
    
            var container = document.createElement("span");
    
            //create and style inputs
            var start = document.createElement("input");
            start.setAttribute("type", "number");
            start.setAttribute("placeholder", "Min");
            start.setAttribute("min", 0);
            start.setAttribute("max", 300);
            start.style.padding = "4px";
            start.style.width = "50%";
            start.style.boxSizing = "border-box";
    
            start.value = cell.getValue();
    
            function buildValues(){
            success({
                start:start.value,
                end:end.value,
            });
            }
    
            function keypress(e){
            if(e.keyCode == 13){
                buildValues();
            }
    
            if(e.keyCode == 27){
                cancel();
            }
            }
    
            end = start.cloneNode();
            end.setAttribute("placeholder", "Max");
    
            start.addEventListener("change", buildValues);
            start.addEventListener("blur", buildValues);
            start.addEventListener("keydown", keypress);
    
            end.addEventListener("change", buildValues);
            end.addEventListener("blur", buildValues);
            end.addEventListener("keydown", keypress);
    
    
            container.appendChild(start);
            container.appendChild(end);
    
            return container;
        }
        
        
        var minMaxFilterFunction = function (headerValue, rowValue, rowData, filterParams) {
            if (rowValue !== null && rowValue !== undefined) {
                if (headerValue.start !== "") {
                    if (headerValue.end !== "") {
                        return rowValue >= parseFloat(headerValue.start) && rowValue <= parseFloat(headerValue.end);
                    } else {
                        return rowValue >= parseFloat(headerValue.start);
                    }
                } else {
                    if (headerValue.end !== "") {
                        return rowValue <= parseFloat(headerValue.end);
                    }
                }
            }
    
            return true;
        }
    
        //Função que recebe uma string com a data e calcula o valor da semana do ano
        function getWeekNumber(date){
            var parts = date.split("/");
            var dateFormat = new Date(parts[2], parts[1] - 1, parts[0]);
            console.log(dateFormat);
    
            startDate = new Date(dateFormat.getFullYear(), 0, 1);
            let days = Math.floor((dateFormat - startDate) / (24 * 60 * 60 * 1000));
            
            let weekNumber = Math.ceil(days / 7);
            return weekNumber;
        }
    
        function calculateWeekDifference(data1, data2) {
            const diferencaEmMilissegundos = Math.abs(data2 - data1);
            const umaSemanaEmMilissegundos = 7 * 24 * 60 * 60 * 1000;
            return Math.ceil(diferencaEmMilissegundos / umaSemanaEmMilissegundos);
        }
    
        fetch(pathJson)
        .then(response => {
            // Check if the request was successful
            if (!response.ok) {
            throw new Error(`Failed to fetch ${pathJson}: ${response.statusText}`);
            }
    
            // Parse the JSON data
            return response.json();
        })
    
        .then(data => {
            // 'data' is now an array containing the parsed JSON content
            var table = new Tabulator("#table-horario", {
            height:"700px",
            layout:"fitColumns",
            data: data,
            columns: [
                {title: "Edifício", field:"Edifício", headerFilter: "input"},
                {title: "Nome sala", field:"Nome sala", headerFilter:"input"},
                {title: "Capacidade Normal", field:"Capacidade Normal", headerFilter:"input"},
                {title: "Capacidade Exame", field:"Capacidade Exame", headerFilter:"input"},
                {title: "Nº características", field:"Nº características", headerFilter:"input"},
                {title: "Anfiteatro aulas", field:"Anfiteatro aulas", headerFilter:"input"},
                {title: "Apoio técnico eventos", field:"Apoio técnico eventos", headerFilter:"input"},
                {title: "Arq 1", field:"Arq 1", align:"center",formatter:"tickCross"},
                {title: "Arq 2", field:"Arq 2", headerFilter:"input",formatter:"tickCross"},
                {title: "Arq 3", field:"Arq 3", headerFilter:"input",formatter:"tickCross"},
                {title: "Arq 4", field:"Arq 4", headerFilter:"input",formatter:"tickCross"},
                {title: "Arq 5", field:"Arq 5", headerFilter:"input",formatter:"tickCross"},
                {title: "Arq 6", field:"Arq 6", headerFilter:"input",formatter:"tickCross"},
                {title: "Arq 9", field:"Arq 9", headerFilter:"input",formatter:"tickCross"},
                {title: "BYOD (Bring Your Own Device)", field:"BYOD (Bring Your Own Device)", headerFilter:"input",formatter:"tickCross"},
                {title: "Focus Group", field:"Focus Group", headerFilter:"input",formatter:"tickCross"},
                {title: "Horário sala visível portal público", field:"Horário sala visível portal público", headerFilter:"input",formatter:"tickCross"},
                {title: "Laboratório de Arquictetura de Computadores I", field:"Laboratório de Arquictetura de Computadores I", headerFilter:"input",formatter:"tickCross"},
                {title: "Laboratório de Arquictetura de Computadores II", field:"Laboratório de Arquictetura de Computadores II", headerFilter:"input",formatter:"tickCross"},
                {title: "Laboratório de Base de Engenharia", field:"Laboratório de Base de Engenharia", headerFilter:"input",formatter:"tickCross"},
                {title: "Laboratório de Eletrónica", field:"Laboratório de Eletrónica", headerFilter:"input",formatter:"tickCross"},
                {title: "Laboratório de Informática", field:"Laboratório de Informática", headerFilter:"input",formatter:"tickCross"},
                {title: "Laboratório de Jornalismo", field:"Laboratório de Jornalismo", headerFilter:"input",formatter:"tickCross"},
                {title: "Laboratório de Redes de Computadores I", field:"Laboratório de Redes de Computadores I", headerFilter:"input",formatter:"tickCross"},
                {title: "Laboratório de Redes de Computadores II", field:"Laboratório de Redes de Computadores II", headerFilter:"input",formatter:"tickCross"},
                {title: "Laboratório de Telecomunicações", field:"Laboratório de Telecomunicações", headerFilter:"input",formatter:"tickCross"},
                {title: "Sala Aulas Mestrado", field:"Sala Aulas Mestrado", headerFilter:"input",formatter:"tickCross"},
                {title: "Sala Aulas Mestrado Plus", field:"Sala Aulas Mestrado Plus", headerFilter:"input",formatter:"tickCross"},
                {title: "Sala NEE", field:"Sala NEE", headerFilter:"input",formatter:"tickCross"},
                {title: "Sala Provas", field:"Sala Provas", headerFilter:"input",formatter:"tickCross"},
                {title: "Sala Reunião", field:"Sala Reunião", headerFilter:"input",formatter:"tickCross"},
                {title: "Sala de Arquitetura", field:"Sala de Arquitetura", headerFilter:"input",formatter:"tickCross"},
                {title: "Sala de Aulas normal", field:"Sala de Aulas normal", headerFilter:"input",formatter:"tickCross"},
                {title: "videoconferência", field:"videoconferência", headerFilter:"input",formatter:"tickCross"},
                {title: "átrio", field:"átrio", headerFilter:"input",formatter:"tickCross",


                    formatter: function(cell, formatterParams, onRendered) {
                        var dateValue = cell.getValue();
                        console.log(dateValue)
                        if (dateValue) {
                            var wn = getWeekNumber(dateValue);
                            return wn;
                        }
                        return "";
                    }},
                {title: "Semana do semestre", field:"Data da aula", headerFilter:"input",
                    formatter: function (cell, formatterParams, onRendered) {
    
                        // Data da primeira semana do semestre
                        const primeiraSemanaSemestre = new Date('2022-09-02');
    
                        // Data da última semana do semestre
                        const ultimaSemanaSemestre = new Date('2023-07-06');
    
                        const numSemanasNoSemestre = calculateWeekDifference(primeiraSemanaSemestre, ultimaSemanaSemestre);
                        return "";
                    }
                }
            ],
        });
    
            
        })
        .catch(error => {
            console.error(`Error loading ${pathJson}:`, error);
        });
         
        </script>
        </div>


</body>
