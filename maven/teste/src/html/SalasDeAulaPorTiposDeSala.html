<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Salas ISCTE</title>
    <link href="https://unpkg.com/tabulator-tables/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables/dist/js/tabulator.min.js"></script>
</head>

<body>


    <div id="Filtro Localização">
        <!-- Adicionando o seletor de localização -->
        <label for="location-filter">Filtrar por localização:</label>
        <select id="location-filter">
            <option value="Edifício I (ISCTE-IUL)">Edifício I (ISCTE-IUL)</option>
            <option value="Edifício II (ISCTE-IUL)">Edifício II (ISCTE-IUL)</option>
            <option value="Polidesportivo (ISCTE-IUL)">Polidesportivo (ISCTE-IUL)</option>
            <option value="Ala Autónoma (ISCTE-IUL)">Ala Autónoma (ISCTE-IUL)</option>
            <!-- Adicione mais opções conforme necessário -->
        </select>

        <button id="clear-filter">Limpar Filtro</button>
    </div>
    <div id="table-horario">

        <script type="text/javascript">



            const pathJson = '../../../../../CaracterizaçãoDasSalas.json';

            var minMaxFilterEditor = function (cell, onRendered, success, cancel, editorParams) {

                var end;

                var container = document.createElement("span");

                //create and style inputs
                var start = document.createElement("input");
                start.setAttribute("type", "number");
                start.setAttribute("placeholder", "Min");
                start.setAttribute("min", 0);
                start.setAttribute("max", 300);
                start.style.padding = "4px";
                start.style.width = "50%";
                start.style.boxSizing = "border-box";

                start.value = cell.getValue();

                function buildValues() {
                    success({
                        start: start.value,
                        end: end.value,
                    });
                }

                function keypress(e) {
                    if (e.keyCode == 13) {
                        buildValues();
                    }

                    if (e.keyCode == 27) {
                        cancel();
                    }
                }

                end = start.cloneNode();
                end.setAttribute("placeholder", "Max");

                start.addEventListener("change", buildValues);
                start.addEventListener("blur", buildValues);
                start.addEventListener("keydown", keypress);

                end.addEventListener("change", buildValues);
                end.addEventListener("blur", buildValues);
                end.addEventListener("keydown", keypress);


                container.appendChild(start);
                container.appendChild(end);

                return container;
            }


            var minMaxFilterFunction = function (headerValue, rowValue, rowData, filterParams) {
                if (rowValue !== null && rowValue !== undefined) {
                    if (headerValue.start !== "") {
                        if (headerValue.end !== "") {
                            return rowValue >= parseFloat(headerValue.start) && rowValue <= parseFloat(headerValue.end);
                        } else {
                            return rowValue >= parseFloat(headerValue.start);
                        }
                    } else {
                        if (headerValue.end !== "") {
                            return rowValue <= parseFloat(headerValue.end);
                        }
                    }
                }

                return true;
            }

            //Função que recebe uma string com a data e calcula o valor da semana do ano
            function getWeekNumber(date) {
                var parts = date.split("/");
                var dateFormat = new Date(parts[2], parts[1] - 1, parts[0]);
                console.log(dateFormat);

                startDate = new Date(dateFormat.getFullYear(), 0, 1);
                let days = Math.floor((dateFormat - startDate) / (24 * 60 * 60 * 1000));

                let weekNumber = Math.ceil(days / 7);
                return weekNumber;
            }

            function calculateWeekDifference(data1, data2) {
                const diferencaEmMilissegundos = Math.abs(data2 - data1);
                const umaSemanaEmMilissegundos = 7 * 24 * 60 * 60 * 1000;
                return Math.ceil(diferencaEmMilissegundos / umaSemanaEmMilissegundos);
            }

            fetch(pathJson)
                .then(response => {
                    // Check if the request was successful
                    if (!response.ok) {
                        throw new Error(`Failed to fetch ${pathJson}: ${response.statusText}`);
                    }

                    // Parse the JSON data
                    return response.json();
                })

                .then(data => {
                    // 'data' is now an array containing the parsed JSON content
                    var table = new Tabulator("#table-horario", {
                        height: "700px",
                        width: "1000",
                        layout: "fitColumns",
                        data: data,
                        columns: [
                            { title: "Edifício", field: "Edificio", headerFilter: true, width: 200 },
                            { title: "Nome sala", field: "Nome sala", headerFilter: true },
                            { title: "Capacidade Normal", field: "Capacidade Normal", headerFilter: true, sorter:"number",headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction, headerFilterLiveFilter:false },
                            { title: "Capacidade Exame", field: "Capacidade Exame", headerFilter: true, sorter:"number",headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction, headerFilterLiveFilter:false},
                            { title: "Nº características", field: "Nº características", headerFilter: true },
                            { title: "Anfiteatro aulas", field: "Anfiteatro aulas", headerFilter: true, formatter: "tickCross" },
                            { title: "Apoio técnico eventos", field: "Apoio técnico eventos", headerFilter: true,formatter: "tickCross" },
                            { title: "Arq 1", field: "Arq 1",headerFilter: true, align: "center", formatter: "tickCross" },
                            { title: "Arq 2", field: "Arq 2", headerFilter: true, formatter: "tickCross" },
                            { title: "Arq 3", field: "Arq 3", headerFilter: true, formatter: "tickCross" },
                            { title: "Arq 4", field: "Arq 4", headerFilter: true, formatter: "tickCross" },
                            { title: "Arq 5", field: "Arq 5", headerFilter: true, formatter: "tickCross" },
                            { title: "Arq 6", field: "Arq 6", headerFilter: true, formatter: "tickCross" },
                            { title: "Arq 9", field: "Arq 9", headerFilter: true, formatter: "tickCross" },
                            { title: "BYOD (Bring Your Own Device)", field: "BYOD (Bring Your Own Device)", headerFilter: true, formatter: "tickCross" },
                            { title: "Focus Group", field: "Focus Group", headerFilter: true, formatter: "tickCross" },
                            { title: "Horário sala visível portal público", field: "Horário sala visível portal público", headerFilter: true, formatter: "tickCross" },
                            { title: "Laboratório de Arquictetura de Computadores I", field: "Laboratório de Arquictetura de Computadores I", headerFilter: true, formatter: "tickCross" },
                            { title: "Laboratório de Arquictetura de Computadores II", field: "Laboratório de Arquictetura de Computadores II", headerFilter: true, formatter: "tickCross" },
                            { title: "Laboratório de Base de Engenharia", field: "Laboratório de Base de Engenharia", headerFilter: true, formatter: "tickCross" },
                            { title: "Laboratório de Eletrónica", field: "Laboratório de Eletrónica", headerFilter: true, formatter: "tickCross" },
                            { title: "Laboratório de Informática", field: "Laboratório de Informática", headerFilter: true, formatter: "tickCross" },
                            { title: "Laboratório de Jornalismo", field: "Laboratório de Jornalismo", headerFilter: true, formatter: "tickCross" },
                            { title: "Laboratório de Redes de Computadores I", field: "Laboratório de Redes de Computadores I", headerFilter: true, formatter: "tickCross" },
                            { title: "Laboratório de Redes de Computadores II", field: "Laboratório de Redes de Computadores II", headerFilter: true, formatter: "tickCross" },
                            { title: "Laboratório de Telecomunicações", field: "Laboratório de Telecomunicações", headerFilter: true, formatter: "tickCross" },
                            { title: "Sala Aulas Mestrado", field: "Sala Aulas Mestrado", headerFilter: true, formatter: "tickCross" },
                            { title: "Sala Aulas Mestrado Plus", field: "Sala Aulas Mestrado Plus", headerFilter: true, formatter: "tickCross" },
                            { title: "Sala NEE", field: "Sala NEE", headerFilter: true, formatter: "tickCross" },
                            { title: "Sala Provas", field: "Sala Provas", headerFilter: true, formatter: "tickCross" },
                            { title: "Sala Reunião", field: "Sala Reunião", headerFilter: true, formatter: "tickCross" },
                            { title: "Sala de Arquitetura", field: "Sala de Arquitetura", headerFilter: true, formatter: "tickCross" },
                            { title: "Sala de Aulas normal", field: "Sala de Aulas normal", headerFilter: true, formatter: "tickCross" },
                            { title: "videoconferência", field: "videoconferência", headerFilter: true, formatter: "tickCross" },
                            { title: "átrio", field: "átrio", formatter: "tickCross",

                                formatter: function (cell, formatterParams, onRendered) {
                                    var dateValue = cell.getValue();
                                    console.log(dateValue)
                                    if (dateValue) {
                                        var wn = getWeekNumber(dateValue);
                                        return wn;
                                    }
                                    return "";
                                }
                            },
                        ],
                    });


                    document.getElementById("location-filter").addEventListener("change", function () {
                        const selectedLocation = this.value;
                        table.setFilter("Edificio", "like", selectedLocation);
                        
                    });

                    // Evento de clique no botão para limpar o filtro
                    document.getElementById("clear-filter").addEventListener("click", function () {
                        document.getElementById("location-filter").value = ""; // Limpa o seletor de localização
                        table.clearFilter();
                    });

                })

                .catch(error => {
                    console.error(`Error loading ${pathJson}:`, error);
                });

        </script>
    </div>


</body>